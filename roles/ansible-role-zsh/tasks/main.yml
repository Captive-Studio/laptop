---
- include_tasks: "{{ item }}"
  with_first_found:
    - "./setup-{{ ansible_distribution }}-{{ ansible_distribution_major_version | int}}.yml"
    - "./setup-{{ ansible_distribution }}.yml"
    - "./setup-{{ ansible_os_family }}.yml"
    - "./setup-default.yml"

- name: Configure ZSH (zshrc)
  blockinfile:
    path: "{{ ansible_env.HOME }}/.zshrc"
    marker: "# {mark} Generated by Ansible"
    insertbefore: BOF
    block: "{{ lookup('file', './templates/zshrc') }}"
    create: yes
    validate: "zsh -n %s"
  become_user: "{{ ansible_env.USER }}"

- name: Configure ZSH (zprofile)
  blockinfile:
    path: "{{ ansible_env.HOME }}/.zprofile"
    marker: "# {mark} Generated by Ansible"
    insertafter: EOF
    block: "{{ lookup('file', './templates/zprofile') }}"
    create: yes
    validate: "zsh -n %s"
  become_user: "{{ ansible_env.USER }}"

- name: Configure ZSH Startup ($XDG_DATA_HOME/zsh/00_init.sh)
  copy:
    src: './templates/init.sh'
    dest: "{{ ansible_env.XDG_DATA_HOME }}/zsh/00_init.sh"
    validate: "zsh -n %s"
  become_user: "{{ ansible_env.USER }}"

- name: Configure Shell to ZSH
  user:
    name={{ ansible_env.USER }}
    shell=/bin/zsh
  become: true
